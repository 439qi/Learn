# 汇编

- [x86-64寄存器和栈帧](https://zhuanlan.zhihu.com/p/440016053)
    有少量错误，注意甄别

## 寄存器

|64|32|16|8|用途|是否在函数调用间保留|
|-|-|-|-|-|-|
|rax|eax|ax|al|函数返回值寄存器|×|
|rbx|ebx|bx|bl|被调者保存寄存器；基址指针|●|
|rcx|ecx|cx|cl|传递第四个参数|×|
|rdx|edx|dx|dl|传递第三个参数；|×|
|rsi|esi|si|sil|传递第二个参数|×|
|rdi|edi|di|dil|传递第一个参数|×|
|rbp|ebp|bp|bpi|栈底指针|●|
|rsp|esp|sp|spi|被调者保存寄存器；栈顶指针|●|
|r8|r8d|r8w|r8b|传递第五个参数|×|

被调者保存寄存器：  
由被调用者在使用之前保存，并在返回之前恢复  
调用者使用原则：  
由调用者调用子函数前保存，并在返回之后恢复

### 说明

- 常用寄存器有16个，分为x86通用寄存器以及r8-r15寄存器。
- 通用寄存器中，函数执行前后必须保持原始的寄存器有3个：是rbx、rbp、rsp。rx寄存器中，最后4个必须保持原值：r12、r13、r14、r15。
保持原值的意义是为了让当前函数有可信任的寄存器，减小在函数调用过程中的保存&恢复操作。除了rbp、rsp用于特定用途外，其余5个寄存器可随意使用。
- 通用寄存器中，不必假设保存值可随意使用的寄存器有5个：是rax、rcx、rdx、rdi、rsi。其中rax用于第一个返回寄存器（当 然也可以用于其它用途），rdx用于第二个返回寄存器（在调用函数时也用于第三个参数寄存器）。rcx用于第四个参数。rdi用于第一个参数。rsi用于 第二个函数参数。
- r8、r9分配用于第5、第6个参数。

### 参数传递

X86时代，参数通过栈来传递，在64时代，第1到6个参数通过寄存器来存储，多于6个的仍通过栈传递
